# 가비지 컬렉션
: 더는 쓸모 없어지게 된 메모리들은 어떻게 처리될까?\
: 자바스크립트 엔진이 어떻게 필요 없는 것을 찾아내 삭제하는지 알아보자.
## 가비지 컬렉션 기준
: 도달 가능성(reachability)이라는 개념을 사용해 메모리 관리를 수행한다.\
=> 어떻게든 접근하거나 사용할 수 있는 값을 의미한다.
~> 도달 가능한 값은 메모리에서 삭제 X.

#### 1.명백한 이유 없이 삭제되지 않는 값들
: 루트(root)
- 현재 함수의 지역 변수와 매개변수
- 중첩 함수의 체인에 있는 함수에서 사용되는 변수와 매개변수
- 전역 변수
- 기타 등등
#### 2.루트가 참조하는 값이나 체이닝으로 루트에서 참조할 수 있는 값

### 간단한 예시
: John은 도달할 수 없는 상태가 되어서 John에 접근할 방법도, John을 참조하는 것도 모두 사라졌다.\
=> 가비지 컬렉터는 이제 John에 저장된 데이터를 삭제하고, John을 메모리에서 삭제함.
``` js
// user엔 객체 참조 값이 저장됩니다.
let user = {
  name: "John"
};

user = null;
```

### 연결된 객체
``` js
function marry(man, woman) {
  woman.husband = man;
  man.wife = woman;

  return {
    father: man,
    mother: woman
  }
}

let family = marry({
  name: "John"
}, {
  name: "Ann"
});
```
<img src="JavaScript/modernJS/img/garbage_collection1.PNG">

``` js
delete family.father;
delete family.mother.husband;
```
<img src="JavaScript/modernJS/img/garbage_collection2.PNG">
<img src="JavaScript/modernJS/img/garbage_collection3.PNG">

### 도달할 수 없는 섬
: 근원 객체 family가 아무것도 참조하지 않도록 해보자.
``` js
family = null;
```
<img src="JavaScript/modernJS/img/garbage_collection4.PNG">

### 내부 알고리즘
: 'mark-and-sweep’이라 불리는 가비지 컬렉션 기본 알고리즘.
1. 가비지 컬렉터는 루트(root) 정보를 수집하고 이를 ‘mark(기억)’ 한다.
2. 루트가 참조하고 있는 모든 객체를 방문하고 이것들을 ‘mark’ 한다.
3. mark 된 모든 객체에 방문하고 그 객체들이 참조하는 객체도 mark 한다. 한번 방문한 객체는 전부 mark 하기 때문에 같은 객체를 다시 방문하는 일은 없다.
4. 루트에서 도달 가능한 모든 객체를 방문할 때까지 위 과정을 반복한다.
5. mark 되지 않은 모든 객체를 메모리에서 삭제한다.

### 가비지 컬렉션을 더 빠르게 하는 최적화 기법
#### 1. generational collection(세대별 수집)
: 객체를 '새로운 객체’와 '오래된 객체’로 나눈다.\
: 객체 상당수는 생성 이후 제 역할을 빠르게 수행해 금방 쓸모가 없어지는데, 이런 객체를 '새로운 객체’로 구분한다.\
: 가비지 컬렉터는 이런 객체를 바로 메모리에서 제거하고 일정 시간 이상 동안 살아남은 객체는 '오래된 객체’로 분류하고, 가비지 컬렉터가 신경을 덜 쓰게 된다.
#### 2. incremental collection(점진적 수집)
: 방문해야 할 객체가 많다면 모든 객체를 한 번에 방문하고 mark 하는데 상당한 시간이 소모된다.\
: 그렇게 되면 가비지 컬렉션에 많은 리소스가 사용되어 실행 속도도 눈에 띄게 느려지기 때문에, 가비지 컬렉션을 여러 부분으로 분리한 다음, 각 부분을 별도로 수행한다.\
: 작업을 분리하고, 변경 사항을 추적하는 데 추가 작업이 필요하긴 하지만, 긴 지연을 짧은 지연 여러 개로 분산시킬 수 있다는 장점이 있다.
#### 3. idle-time collection(유휴 시간 수집)
: 가비지 컬렉터는 실행에 주는 영향을 최소화하기 위해 CPU가 유휴 상태일 때에만 가비지 컬렉션을 실행한다.
